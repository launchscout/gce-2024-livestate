<html>

<head>

  <!-- Generated by @jspm/generator VSCode Extension - https://github.com/jspm/jspm-vscode -->
  <script async src="https://ga.jspm.io/npm:es-module-shims@1.9.0/dist/es-module-shims.js" crossorigin="anonymous"></script>
  <script type="importmap">
  {
    "imports": {
      "@preact/signals": "https://ga.jspm.io/npm:@preact/signals@1.2.3/dist/signals.module.js",
      "htm": "https://ga.jspm.io/npm:htm@3.1.1/dist/htm.module.js",
      "phx-live-state": "https://ga.jspm.io/npm:phx-live-state@0.11.2/build/src/index.js",
      "preact": "https://ga.jspm.io/npm:preact@10.20.2/dist/preact.module.js",
      "signal-polyfill": "https://ga.jspm.io/npm:signal-polyfill@0.1.0/dist/index.js",
      "subscript": "https://ga.jspm.io/npm:subscript@8.3.4/subscript.js"
    },
    "scopes": {
      "https://ga.jspm.io/": {
        "@preact/signals-core": "https://ga.jspm.io/npm:@preact/signals-core@1.6.0/dist/signals-core.module.js",
        "json-joy/esm/json-patch": "https://ga.jspm.io/npm:json-joy@1.19.0/esm/json-patch/index.js",
        "phoenix": "https://ga.jspm.io/npm:phoenix@1.6.15/priv/static/phoenix.mjs",
        "preact/hooks": "https://ga.jspm.io/npm:preact@10.20.2/hooks/dist/hooks.module.js",
        "process": "https://ga.jspm.io/npm:@jspm/core@2.0.1/nodelibs/browser/process.js",
        "reflect-metadata": "https://ga.jspm.io/npm:reflect-metadata@0.1.14/Reflect.js",
        "subscript": "https://ga.jspm.io/npm:subscript@7.6.2/subscript.js",
        "wc-context": "https://ga.jspm.io/npm:wc-context@1.0.0/core.js"
      }
    }
  }
  </script>
  <script type="module">
    import { h, render } from 'preact';
    import htm from 'htm';
    import { createPreactSignal } from './live-signals.js';

    const [messageSignal, dispatchEvent] = createPreactSignal({
      url: 'ws://localhost:4000/live_state',
      topic: 'chat_room:denver_elixir',
      initialValue: [],
      path: 'messages'
    });
    const html = htm.bind(h);

    function Chat(props) {
      const onSubmit = (event) => {
        event.preventDefault();
        const data = Object.fromEntries(new FormData(event.target));
        dispatchEvent(new CustomEvent('send_message', { detail: data }));
        event.target.clear();
      };
      return html`
    <table>
      <thead>
        <tr>
          <th>Author</th>
          <th>Message</th>
        </tr>
      </thead>
      <tbody>
        ${messageSignal.value.map((message) => html`
        <tr>
          <td>${message.author}</td>
          <td>${message.message}</td>
          <td></td>
        </tr>`)}
      </tbody>
    </table>
    <form onSubmit=${onSubmit}>
      <div>
        <label>Author</label>
        <input type="text" name="author" />
      </div>
      <div>
        <label>Message</label>
        <input type="text" name="message" />
      </div>
      <button type="submit">Add</button>
    </form>
    `;
    }

    render(html`<${Chat} />`, document.body);
  </script>
</head>

<body></body>

</html>